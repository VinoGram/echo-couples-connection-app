generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String    @id @default(cuid())
  email       String    @unique
  password    String
  createdAt   DateTime  @default(now())
  lastLoginAt DateTime?
  
  profile   UserProfile?
  couple1   Couple[] @relation("User1")
  couple2   Couple[] @relation("User2")
  responses Response[]
  gameResults GameResult[] @relation("Player1")
  gameResults2 GameResult[] @relation("Player2")
  quizzes   Quiz[]
  messages  Message[]
}

model UserProfile {
  id                      String @id @default(cuid())
  userId                  String @unique
  displayName             String
  avatar                  String?
  gender                  String? // "male" or "female"
  birthday                DateTime?
  religion                String? // christian, muslim, hindu, jewish, buddhist, other
  totalXP                 Int    @default(0)
  level                   Int    @default(1)
  currentStreak           Int    @default(0)
  longestStreak           Int    @default(0)
  achievements            String @default("[]")
  notificationPreferences String @default("{}")
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Couple {
  id             String   @id @default(cuid())
  user1Id        String
  user2Id        String
  connectionCode String   @unique
  anniversaryDate DateTime?
  createdAt      DateTime @default(now())
  streak         Int      @default(0)
  totalXP        Int      @default(0)
  level          Int      @default(1)
  
  user1         User           @relation("User1", fields: [user1Id], references: [id])
  user2         User           @relation("User2", fields: [user2Id], references: [id])
  dailyQuestions DailyQuestion[]
  responses     Response[]
  gameResults   GameResult[]
  exercises     Exercise[]
  quizzes       Quiz[]
  messages      Message[]
}

model Message {
  id        String   @id @default(cuid())
  coupleId  String
  senderId  String
  content   String
  createdAt DateTime @default(now())
  
  couple Couple @relation(fields: [coupleId], references: [id])
  sender User   @relation(fields: [senderId], references: [id])
}

model Question {
  id       String @id @default(cuid())
  text     String
  category String // love, memories, desires, dates, finance, sex, family, future, fun
  depth    String // light, deep
  module   String @default("daily") // daily, questions_bank, games, exercises
  occasion String? // christmas, easter, birthday, ramadan, diwali, valentine, anniversary, new_year
  isActive Boolean @default(true)
  
  dailyQuestions DailyQuestion[]
}

model DailyQuestion {
  id          String   @id @default(cuid())
  coupleId    String
  questionId  String
  date        String
  isCompleted Boolean  @default(false)
  xpAwarded   Int      @default(0)
  createdAt   DateTime @default(now())
  
  couple    Couple     @relation(fields: [coupleId], references: [id])
  question  Question   @relation(fields: [questionId], references: [id])
  responses Response[]
  
  @@unique([coupleId, date])
}

model Response {
  id              String   @id @default(cuid())
  userId          String
  coupleId        String
  dailyQuestionId String
  answer          String
  isPrivate       Boolean  @default(true)
  createdAt       DateTime @default(now())
  
  user            User          @relation(fields: [userId], references: [id])
  couple          Couple        @relation(fields: [coupleId], references: [id])
  dailyQuestion   DailyQuestion @relation(fields: [dailyQuestionId], references: [id])
}

model GameResult {
  id          String   @id @default(cuid())
  coupleId    String
  gameType    String // this_or_that, guess_my_answer, memory_lane, would_you_rather
  player1Id   String
  player2Id   String
  score       Int
  data        String
  completedAt DateTime @default(now())
  
  couple  Couple @relation(fields: [coupleId], references: [id])
  player1 User   @relation("Player1", fields: [player1Id], references: [id])
  player2 User   @relation("Player2", fields: [player2Id], references: [id])
}

model Exercise {
  id          String   @id @default(cuid())
  coupleId    String
  type        String // appreciation_wall, love_map, dream_board, conflict_compass
  data        String
  lastUpdated DateTime @default(now())
  
  couple Couple @relation(fields: [coupleId], references: [id])
}

model Quiz {
  id          String   @id @default(cuid())
  userId      String
  coupleId    String
  quizType    String // love_language, financial_personality, intimacy_spectrum
  results     String
  completedAt DateTime @default(now())
  
  user   User   @relation(fields: [userId], references: [id])
  couple Couple @relation(fields: [coupleId], references: [id])
}